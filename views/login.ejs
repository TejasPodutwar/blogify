<!DOCTYPE html>
<html lang="en">
    <%- include("./templates/head.ejs") %>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <%- include("./templates/navbar.ejs") %>

    <div class="create-content login">
        <div class="form-wrapper">
            <form class="login-form">
                <h2 class="content-title">LOGIN</h2>
                <label for="email">Email: </label>
                <input type="email" id="email" name="email" required><br>
                <div class="email error"></div>
                <br>
                <label for="password">Password: </label>
                <input type="password" id="password" name="password" required></input><br>
                <div class="password error"></div>
                <br>
                <button type="submit">Submit</button>
            </form>
        </div>
    </div>
    <script>
        const form_elem = document.querySelector('.login-form');
        const emailError = document.querySelector('.email.error');
        const passwordError = document.querySelector('.password.error');

        form_elem.addEventListener("submit", async (e)=>{

            e.preventDefault();
            const email  = form_elem.email.value;
            const password = form_elem.password.value;
    
            emailError.textContent = '';
            passwordError.textContent = '';

            try {

                const res = await fetch('/auth/login',{
                    method: 'POST',
                    body: JSON.stringify({email,password}),
                    headers: { 'Content-Type': 'application/json'}
                }) 
                
                const data = await res.json();

                if(data.errors){
                    emailError.textContent = data.errors['email']
                    passwordError.textContent = data.errors['password']
                }

                if(data.user){
                    window.location.href = '/';
                }

            } 
            catch (err) {
                console.log(err);
            }      
        })

    </script>
    <%- include("./templates/footer.ejs") %> 
</body>
</html>