<!DOCTYPE html>
<html lang="en">
    <%- include("./templates/head.ejs") %>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <%- include("./templates/navbar.ejs") %>

    <div class="create-content signup">
        <div class="form-wrapper">
            <form class="signup-form">
                <h2 class="content-title">SIGN UP USER</h2>
                <label for="username">Username: </label>
                <input type="text" name="username" required>
                <div class="username error"></div>
                <br><br>
                <label for="email">Email: </label>
                <input type="email" name="email" required>
                <div class="email error"></div>
                <br><br>
                <label for="password">Password: </label>
                <input type="password" name="password" required></input>
                <div class="password error"></div>
                <br><br>
                <button type="submit">Submit</button>
            </form>
        </div>
    </div>
    <script>
        const form_elem = document.querySelector('.signup-form');
        const emailError = document.querySelector('.email.error');
        const passwordError = document.querySelector('.password.error');
        const userError = document.querySelector('.username.error');

        form_elem.addEventListener("submit", async (e)=>{

            e.preventDefault();
            const username = form_elem.username.value;
            const email  = form_elem.email.value;
            const password = form_elem.password.value;
        
            userError.textContent = '';
            emailError.textContent = '';
            passwordError.textContent = '';

            try {

                const res = await fetch('/auth/signup',{
                    method: 'POST',
                    body: JSON.stringify({username,email,password}),
                    headers: { 'Content-Type': 'application/json'}
                }) 
                
                const data = await res.json();

                if(data.errors){
                    userError.textContent = data.errors['username']
                    emailError.textContent = data.errors['email']
                    passwordError.textContent = data.errors['password']
                }

                if(data.user){
                    console.log(data);
                    alert(data.user);
                }

            } 
            catch (err) {
                console.log(err);
            }
                
        })

    </script>
    <%- include("./templates/footer.ejs") %> 
</body>
</html>